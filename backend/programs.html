<?php
include( base_dir . "backend/functions/programs.php");
include( base_dir . "backend/functions/schedule.php");
?>

<script type="text/javascript">
    $(function(){

        $("#stopmodify").click(function(){
            $("input#programid").val("");

            $("input#pname").val("");
            $("input#pdescription").val("");
            $("input#pimage").val("");
            $("input#pbanner").val("");

            $("#modifybutton").hide();
            $("#addbutton").show();
        });

        $("#modifyprogram").click( function(){
            var url_send = "<?php echo actions_url; ?>admin.php";

            var name = $("input#pname").val();
            var description = $("input#pdescription").val();
            var image = $("input#pimage").val();
            var banner = $("input#pbanner").val();
            var auid = $("#cbusers").val()

            if( name == "" || description == "" || image == "" ) {
                $("#presponse").fadeIn('slow');
                $("#presponse").text("Faltan completar campos");

                setTimeout(function() {
                    $("#presponse").fadeOut('slow');
                }, 2000);

                return false;
            }

            if( $("input#programid").val() != "" ) {
                var pid = $("input#programid").val();
                $.post(url_send,
                {
                    action: 'updateprogram',
                    pid: pid,
                    name: name,
                    description: description,
                    image: image,
                    banner: banner,
                    auid: auid
                },
                function(html) {
                    $("#programs").fadeOut('slow');
                    $("#programs").html(html);
                    $("#programs").fadeIn('slow');

                    $("input#programid").val("");
                    $("input#pname").val("");
                    $("input#pdescription").val("");
                    $("input#pimage").val("");
                    $("input#pbanner").val("");

                    $("#modifybutton").hide();
                    $("#addbutton").show();
                });
            }

            return false;
        });

        $("#saveprogram").click( function(){
            var url_send = "<?php echo actions_url; ?>admin.php";

            var name = $("input#pname").val();
            var description = $("input#pdescription").val();
            var image = $("input#pimage").val();
            var banner = $("input#pbanner").val();
            var auid = $("#cbusers").val()

            if( name == "" || description == "" || image == "" ) {
                $("#presponse").fadeIn('slow');
                $("#presponse").text("Faltan completar campos");

                setTimeout(function() {
                    $("#presponse").fadeOut('slow');
                }, 2000);

                return false;
            }

            if( $("input#programid").val() == "" ) {
                var vars = "action=addprogram&name=" + name + "&description=" + description + "&image=" + image + "&banner=" + banner + "&auid=" + auid;
                $.ajax({
                    type: "POST",
                    url: url_send,
                    data: vars,
                    success: function(html) {
                        $("#programs").fadeOut('slow');
                        $("#programs").html(html);
                        $("#programs").fadeIn('slow');

                        //$("#posts").load("<?php actions_dir; ?>admin.php?action=loadhelp");

                        $("input#pname").val("");
                        $("input#pdescription").val("");
                        $("input#pimage").val("");
                        $("input#pbanner").val("");

                    }
                });
            }

            return false;
        });

    });
</script>

<style type="text/css">
    #feedback { font-size: 1.4em; }
    #selectable .ui-selecting { background: #FECA40; }
    #selectable .ui-selected { background: #F39814; color: white; }
    #selectable { list-style-type: none; margin: 0; padding: 0; width: 60%; }
    #selectable li { margin: 3px; padding: 0.4em; font-size: 1.4em; height: 18px; }
</style>
<script type="text/javascript">
    function addschedule( pid ) {
        $("#spid").val( pid );
        $('#scheduleload').show();
        
        window.location = "#scheduleload";
    };
</script>

<script type="text/javascript">
    function modify( pid ) {
        var url_send = "<?php echo actions_url; ?>admin.php";
        
        $.post(url_send,
        {
            action: 'getprogram',
            pid: pid
        },
        function( data ) {
            $("input#programid").val( pid );
            $("input#pname").val( data.name );
            $("input#pdescription").val( data.description );
            $("input#pimage").val( data.image );
            $("input#pbanner").val( data.banner );

            $("#cbusers option[value='" + data.adminuid + "']").attr("selected", "selected");

            $("#addbutton").hide();
            $("#modifybutton").show();

            window.location = "#programadder";
        });
    };
</script>

<script type="text/javascript">
    function deleteProgram(id, text) {
        jConfirm('Esta seguro que desea eliminar lo siguiente:\n\n' + text, 'Confirmaci√≥n', function(r) {
            if( r ) {
                $('#programs').load("<?php echo actions_url; ?>admin.php?action=deleteprogram&id=" + id);
            }
        });
    };
</script>

<h3 class="ui-widget-header ui-corner-all">Carga de Programaci&oacute;n</h3>
<div id="programadder">
    <input name="programid" type="hidden" id="programid" class="text ui-widget-content ui-corner-all" />
    Nombre: <input name="textfield" type="text" id="pname" class="text ui-widget-content ui-corner-all" size="100" />
    <br />Descripcion: <input name="textfield" type="text" id="pdescription" class="text ui-widget-content ui-corner-all" size="100" />
    <br />Link imagen: <input name="textfield" type="text" id="pimage" class="text ui-widget-content ui-corner-all" size="100" />
    <br />Link banner: <input name="textfield" type="text" id="pbanner" class="text ui-widget-content ui-corner-all" size="100" />
    <br />Administrador Audioblog:
    <?php
    loadUsers();
    ?>
    <div id="presponse"></div>
    <div id="addbutton"><br /><input type="submit" id="saveprogram" value="Guardar" class="ui-button ui-state-default ui-corner-all" /></div>
    <div id="modifybutton" style="display: none;">
        <input type="button" id="modifyprogram" value="Modificar" class="ui-button ui-state-default ui-corner-all" />
        <input type="button" id="stopmodify" value="Cancelar" class="ui-button ui-state-default ui-corner-all" />
    </div>
</div>
<br />

<h3 class="ui-widget-header ui-corner-all">Programas</h3>
<p id="feedback">
    Seleccione uno:
</p>
<div id="programs">
    <?php
    loadPrograms();
    ?>
</div>

<div id="scheduleload" style="display: none;">

    <script type="text/javascript">
        $(function(){

            $("#saveschedule").click( function(){

                var url_send = "<?php echo actions_url; ?>admin.php";

                var pid = $("input#spid").val();
                var from = $("input#sfrom").val();
                var to = $("input#sto").val();
                var day =  $("#cbschedule").val()

                if( pid == "" || from == "" || to == "" ) {
                    $("#sresponse").fadeIn('slow');
                    $("#sresponse").text("Faltan completar campos");

                    setTimeout(function() {
                        $("#sresponse").fadeOut('slow');
                    }, 2000);

                    return false;
                }

                var vars = "action=addschedule&pid=" + pid + "&from=" + from + "&to=" + to + "&day=" + day;
                $.ajax({
                    type: "POST",
                    url: url_send,
                    data: vars,
                    success: function(html) {
                        $("#schedule").fadeOut('slow');
                        $("#schedule").html(html);
                        $("#schdeule").fadeIn('slow');

                        //$("#posts").load("<?php actions_dir; ?>admin.php?action=loadhelp");

                        $("input#spid").val("");
                        $("input#sfrom").val("");
                        $("input#sto").val("");

                    }
                });
                return false;
            });

        });
    </script>

    <h3 class="ui-widget-header ui-corner-all">Carga de horario</h3>

    La carga se realiza de la siguiente forma:<br/>
    Horario: (HH:MM:SS) - Ejemplo: 01:10:00<br/>
    El horario esta comprendido entre las 00:00:00 hasta las 24:00:00.<br/>
    <br/><br/>Id del programa: <input name="textfield" type="text" id="spid" class="text ui-widget-content ui-corner-all" size="20" readonly />
    <br/>Desde: <input name="textfield" type="text" id="sfrom" class="text ui-widget-content ui-corner-all" size="100" />
    <br />Hasta: <input name="textfield" type="text" id="sto" class="text ui-widget-content ui-corner-all" size="100" />
    <br />
    <select id="cbschedule" >
        <option value="monday">Lunes</option>
        <option value="tuesday">Martes</option>
        <option value="wednesday">Miercoles</option>
        <option value="thursday">Jueves</option>
        <option value="friday">Viernes</option>
        <option value="saturday">Sabado</option>
        <option value="sunday">Domingo</option>
    </select>

    <div id="sresponse"></div>
    <br /><input type="submit" id="saveschedule" value="Guardar" class="ui-button ui-state-default ui-corner-all" />

    <a style="cursor: pointer;" onclick="$('#scheduleload').hide('slow');">Cerrar</a>
    <br />

</div>
<h3 class="ui-widget-header ui-corner-all">Horarios</h3>

<script type="text/javascript">
    function deleteSchedule(id, text) {
        jConfirm('Esta seguro que desea eliminar lo siguiente:\n\n' + text, 'Confirmaci√≥n', function(r) {
            if( r ) {
                $('#schedule').load("<?php echo actions_url; ?>admin.php?action=deleteschedule&id=" + id);
            }
        });
    };
</script>

<div id="schedule">
    <?php
    loadSchedule();
    ?>
</div>